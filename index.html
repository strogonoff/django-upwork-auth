<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>django-upwork-auth by strogonoff</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">django-upwork-auth</h1>
      <h2 class="project-tagline">Simple Upwork login for your Django-based project.</h2>
      <a href="https://github.com/strogonoff/django-upwork-auth" class="btn">View on GitHub</a>
      <a href="https://github.com/strogonoff/django-upwork-auth/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/strogonoff/django-upwork-auth/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="django-upwork-auth" class="anchor" href="#django-upwork-auth" aria-hidden="true"><span class="octicon octicon-link"></span></a>django-upwork-auth</h1>

<p>Upwork OAuth login support for your Django-based project.</p>

<p>Tested with Django 1.8 (see example project).</p>

<p>Before oDesk rebranded as Upwork, this library was called django-odesk-auth.
The latest version of django-odesk-auth works with Upwork already.
This library is not backwards compatible with django-odesk-auth.</p>

<h2>
<a id="creating-upwork-oauth-api-key" class="anchor" href="#creating-upwork-oauth-api-key" aria-hidden="true"><span class="octicon octicon-link"></span></a>Creating Upwork OAuth API key</h2>

<p>Go to <a href="https://www.upwork.com/services/api/apply">https://www.upwork.com/services/api/apply</a>.</p>

<ul>
<li>Authentication type should be set to "OAuth 1.0".</li>
<li>Callback URL should be left blank.</li>
<li>Default authentication backend requires
"View the structure of your companies/teams" permission to be checked.</li>
</ul>

<h2>
<a id="adding-upwork-auth-to-your-django-project" class="anchor" href="#adding-upwork-auth-to-your-django-project" aria-hidden="true"><span class="octicon octicon-link"></span></a>Adding Upwork auth to your Django project</h2>

<p>Make sure you have <code>django-upwork-auth</code> and <code>python-upwork==1.0</code> installed.
Make sure you have Django's sites and session frameworks enabled.</p>

<ol>
<li><p>Add <code>'django_upwork_auth'</code> to <code>INSTALLED_APPS</code>.</p></li>
<li><p>Add <code>'django_upwork_auth.backends.UpworkOAuthBackend'</code>
to AUTHENTICATION_BACKENDS.</p></li>
<li><p>Specify <code>UPWORK_OAUTH_KEY</code> and <code>UPWORK_OAUTH_SECRET</code> settings
with your key information.</p></li>
<li><p>Add <code>'your_upwork_username'</code> to <code>UPWORK_AUTH_ALLOWED_USERS</code>,
and set <code>UPWORK_AUTH_AUTO_CREATE_USERS</code> to True.</p></li>
<li><p>Include <code>django_upwork_auth.urls</code> in your URL patterns.</p></li>
<li><p>In your login page template, put a link (say, "Log in via Upwork")
and point it to <code>{% url "upwork_oauth_login" %}</code>.</p></li>
<li><p>Open login page and click "Log in via Upwork" to verify everything works.</p></li>
</ol>

<p>IMPORTANT: keep <code>UPWORK_OAUTH_KEY</code> and <code>UPWORK_OAUTH_SECRET</code> settings
in a file that is not under version control. One way to do that is to keep
all public settings in versioned file named say <code>settings_base.py</code>,
from which you import everything in <code>settings.py</code> that is not versioned.
Django in this setup should be pointed to <code>settings.py</code>, as usual.</p>

<h2>
<a id="example-project" class="anchor" href="#example-project" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example project</h2>

<p>Requirements: Vagrant, Ansible, and free 8000 port.</p>

<p>First, fill in the necessary settings in <code>example_project/settings.py</code>
(see comments in the file).</p>

<p>From <code>example_project</code> directory, bring up a VM using Vagrantfile provided
and manually run Django development server in it::</p>

<pre><code>$ vagrant up
$ vagrant ssh
vm$ cd /vagrant/example_project/
vm$ ./manage.py runserver 0.0.0.0:8000
</code></pre>

<p>On your host machine, navigate to 127.0.0.1:8000 where you should be able
to test Upwork login functionality in action.</p>

<h2>
<a id="authentication-backend" class="anchor" href="#authentication-backend" aria-hidden="true"><span class="octicon octicon-link"></span></a>Authentication backend</h2>

<p>Stock authentication backend assumes that you only use Upwork login in your app.
When someone logs in, if their Upwork ID matches existing username, it logs
them in as that user. If there's no username matching given Upwork ID, it optionally
creates a user with such username.</p>

<p>ATTENTION: Watch out you are using other authentication methods
or for some reason have any chance of one end user's Upwork ID matching
existing username of another end user!</p>

<p>Stock authentication backend provides optional basic access control facilities.
You can specify who is allowed to log in to your site and who upon login gets
staff and/or superuser statuses. This is configured through Django settings.</p>

<p>If whitelisting is on and given user is not on the white list, their
<code>User.is_active</code> flag gets set to False upon login.</p>

<p>See below for settings provided by stock authentication backend.</p>

<p>You can subclass stock authentication backend to override user manipulation
(see <code>handle_unknown_user()</code> and <code>update_user()</code> methods).</p>

<h2>
<a id="making-authenticated-upwork-api-calls" class="anchor" href="#making-authenticated-upwork-api-calls" aria-hidden="true"><span class="octicon octicon-link"></span></a>Making authenticated Upwork API calls</h2>

<p>After user is successfully authenticated you can call Upwork API on their behalf.
For that you'd need the access token obtained during OAuth flow.</p>

<p>By default this app uses Django's built-in session framework to store
access token. The key it uses can be retrieved from
<code>django_upwork_auth.settings.ACCESS_TOKEN_SESSION_KEY</code>
and customized via <code>UPWORK_OAUTH_ACCESS_TOKEN_SESSION_KEY</code> setting.</p>

<p>Example code you can have in your view::</p>

<pre><code>from django_upwork_auth import utils, settings

upwork_client = utils.get_client(
    request.session[settings.ACCESS_TOKEN_SESSION_KEY])

print upwork_client.hr.get_teams()
# Should output list of teamrooms current user belongs to
</code></pre>

<p>You can use another storage technique by overriding
<code>UPWORK_OAUTH_ACCESS_TOKEN_STORE_FUNC</code>. It's useful if you need to make Upwork API call
but can't easily read user's session because there's no request context.
For example, you can store access token with associated username in Redis
and query it in your asynchronous tasks.</p>

<p>Note:</p>

<ul>
<li><p>How you make API calls is up to you. Internally django-upwork-auth
uses python-upwork library, and so does the above example.</p></li>
<li><p><code>utils.get_client()</code> function returns an instance of <code>upwork.Client</code>.
Handy if you're using python-upwork library to make API calls.</p></li>
</ul>

<h2>
<a id="verifying-oauth-access-token" class="anchor" href="#verifying-oauth-access-token" aria-hidden="true"><span class="octicon octicon-link"></span></a>Verifying OAuth access token</h2>

<p>Sometimes there's a need to make sure that current user's authentication
is still validâ€”that they, for example, didn't revoke access to their account.</p>

<p>This app provides a helper for that: see <code>utils.check_login()</code>.
It can be used in a view like this::</p>

<pre><code>from django_upwork_auth import utils

def oauth_check_login(request):
    u"""Verifies OAuth access token and user status on Upwork.
    Returns HTTP 200 (OK) or HTTP 401 (Unauthorized)
    with additional information in response body text.
    """
    access_token = utils.access_token.get(request)

    if access_token is None or len(access_token) != 2:
        return http.HttpResponse(
            u"Bad or missing Upwork OAuth access token", status=401)

    result, details = utils.check_login(access_token)

    if result is True:
        return http.HttpResponse(details, status=200)
    else:
        return http.HttpResponse(details, status=401)
</code></pre>

<h2>
<a id="available-django-settings" class="anchor" href="#available-django-settings" aria-hidden="true"><span class="octicon octicon-link"></span></a>Available Django settings</h2>

<p>UPWORK_OAUTH_KEY, UPWORK_OAUTH_SECRET
  API key information.</p>

<p>UPWORK_AUTH_LOGIN_REDIRECT_URL = settings.LOGIN_REDIRECT_URL
  Where to redirect the user at the end of OAuth flow.
  Path or URL pattern name.</p>

<p>UPWORK_AUTH_ACCESS_TOKEN_STORE_FUNC
  Function to be called to store OAuth access token for future access.
  It's passed two arguments: a request where user is already
  authenticated and the access token associated with that user.
  Default implementation stores token in session under <code>ACCESS_TOKEN_SESSION_KEY</code>.</p>

<h2>
<a id="settings-specific-to-stock-authentication-backend" class="anchor" href="#settings-specific-to-stock-authentication-backend" aria-hidden="true"><span class="octicon octicon-link"></span></a>Settings specific to stock authentication backend</h2>

<p>These are relevant unless you subclass stock <code>backends.UpworkOAuthBackend</code> and override
some of its logic.</p>

<p>By default anyone can log in. Whitelist mode can be turned on by filling
<code>UPWORK_AUTH_WHITELIST</code> and/or <code>UPWORK_AUTH_TEAM_WHITELIST</code>.</p>

<p>UPWORK_AUTH_AUTO_CREATE_USERS = False
  Whether to create a new account in Django if given user uses Upwork login
  for the first time (i.e., ID returned by Upwork is free in your Django DB).</p>

<p>UPWORK_AUTH_WHITELIST = ()<br>
  Upwork IDs of users who are allowed to log in via Upwork.</p>

<p>UPWORK_AUTH_STAFF_WHITELIST = ()<br>
  Upwork IDs of users who are marked as <code>is_staff</code> upon login.</p>

<p>UPWORK_AUTH_SUPERUSER_WHITELIST = ()<br>
  Upwork IDs of users who are marked as <code>is_superuser</code> upon login.</p>

<p>UPWORK_AUTH_TEAM_WHITELIST = ()<br>
  IDs of Upwork teamrooms, members of which are allowed to log in via Upwork.</p>

<p>UPWORK_AUTH_STAFF_TEAM_WHITELIST = ()<br>
  IDs of Upwork teamrooms, members of which are marked as <code>is_staff</code> upon login.</p>

<p>UPWORK_AUTH_SUPERUSER_TEAM_WHITELIST = ()<br>
  IDs of Upwork teamrooms, members of which are marked as <code>is_superuser</code> upon login.</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/strogonoff/django-upwork-auth">django-upwork-auth</a> is maintained by <a href="https://github.com/strogonoff">strogonoff</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-24538431-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>

